# MediaWiki Parser test cases
# Some taken from http://meta.wikimedia.org/wiki/Parser_testing
# All (C) their respective authors and released under the GPL
#
# The syntax should be fairly self-explanatory.
#
# Currently supported test options:
# One of the following three:
#
#  (default)  generate HTML output
#  pst        apply pre-save transform
#  msg        apply message transform
#
# Plus any combination of these:
#
# cat           add category links
# ill           add inter-language links
# subpage       enable subpages (disabled by default)
# noxml         don't check for XML well formdness
# title=[[XXX]] run test using article title XXX
# language=XXX  set content language to XXX for this test
# variant=XXX   set the variant of language for this test (eg zh-tw)
# disabled      do not run test
# showtitle     make the first line the title
# comment       run through Linker::formatComment() instead of main parser
# local         format section links in edit comment text as local links
#
# For testing purposes, temporary articles can created:
# !!article / NAMESPACE:TITLE / !!text / ARTICLE TEXT / !!endarticle
# where '/' denotes a newline.

# This is the standard article assumed to exist.
!! article
Main Page
!! text
blah blah
!! endarticle

!!article 
Template:Foo
!!text
FOO
!!endarticle

!! article 
Template:Blank
!! text
!! endarticle

!! article
Template:!
!! text
|
!! endarticle

!!article
MediaWiki:bad image list
!!text
* [[File:Bad.jpg]] except [[Nasty page]]
!!endarticle

###
### Basic tests
###
!! test
Blank input
!! input
!! result
!! end


!! test
Simple paragraph
!! input
This is a simple paragraph.
!! result
<p>This is a simple paragraph.</p>
!! end

!! test
Simple list
!! input
* Item 1
* Item 2
!! result
<ul>
<li>Item 1</li>
<li>Item 2</li>
</ul>
!! end

!! test
Italics and bold
!! options
disabled
!! input
* plain
* plain''italic''plain
* plain''italic''plain''italic''plain
* plain'''bold'''plain
* plain'''bold'''plain'''bold'''plain
* plain''italic''plain'''bold'''plain
* plain'''bold'''plain''italic''plain
* plain''italic'''bold-italic'''italic''plain
* plain'''bold''bold-italic''bold'''plain
* plain'''''bold-italic'''italic''plain
* plain'''''bold-italic''bold'''plain
* plain''italic'''bold-italic'''''plain
* plain'''bold''bold-italic'''''plain
* plain l'''italic''plain
* plain l''''bold''' plain
!! result
<ul>
<li>plain</li>
<li>plain<i>italic</i>plain</li>
<li>plain<i>italic</i>plain<i>italic</i>plain</li>
<li>plain<b>bold</b>plain</li>
<li>plain<b>bold</b>plain<b>bold</b>plain</li>
<li>plain<i>italic</i>plain<b>bold</b>plain</li>
<li>plain<b>bold</b>plain<i>italic</i>plain</li>
<li>plain<i>italic<b>bold-italic</b>italic</i>plain</li>
<li>plain<b>bold<i>bold-italic</i>bold</b>plain</li>
<li>plain<i><b>bold-italic</b>italic</i>plain</li>
<li>plain<b><i>bold-italic</i>bold</b>plain</li>
<li>plain<i>italic<b>bold-italic</b></i>plain</li>
<li>plain<b>bold<i>bold-italic</i></b>plain</li>
<li>plain l'<i>italic</i>plain</li>
<li>plain l'<b>bold</b> plain</li></ul>
!! end

###
### <nowiki> test cases
###

!! test
<nowiki> unordered list
!! input
<nowiki>* This is not an unordered list item.</nowiki>
!! result
<p>* This is not an unordered list item.</p>
!! end

!! test
<nowiki> spacing
!! input
<nowiki>Lorem ipsum dolor

sed abit.
  sed nullum.

:and a colon
</nowiki>
!! result
<p>Lorem ipsum dolor

sed abit.
  sed nullum.

:and a colon
</p>
!! end

!! test
nowiki 3
!! input
:There is not nowiki.
:There is <nowiki>nowiki</nowiki>.

#There is not nowiki.
#There is <nowiki>nowiki</nowiki>.

*There is not nowiki.
*There is <nowiki>nowiki</nowiki>.
!! result
<dl>
<dd>There is not nowiki.</dd>
<dd>There is nowiki.</dd>
</dl>


<ol>
<li>There is not nowiki.</li>
<li>There is nowiki.</li>
</ol>


<ul>
<li>There is not nowiki.</li>
<li>There is nowiki.</li>
</ul>
!! end


###
### Comments
###
!! test
Comment test 1
!! options
disabled
!! input
<!-- comment 1 --> asdf
<!-- comment 2 -->
!! result
<pre>asdf
</pre>

!! end

!! test
Comment test 2
!! input
asdf
<!-- comment 1 -->
jkl
!! result
<p>asdf
jkl</p>
!! end

!! test
Comment test 3
!! input
asdf
<!-- comment 1 -->
<!-- comment 2 -->
jkl
!! result
<p>asdf
jkl</p>
!! end

!! test
Comment test 4
!! input
asdf<!-- comment 1 -->jkl
!! result
<p>asdfjkl</p>
!! end

!! test
Comment spacing
!! options
disabled
!! input
a
 <!-- foo --> b <!-- bar -->
c
!! result
<p>a</p>
<pre> b 
</pre>
<p>c</p>
!! end

!! test
Comment whitespace
!! input
<!-- returns a single newline, not nothing, since the newline after > is not stripped -->
!! result

!! end

!! test
Comment semantics and delimiters
!! input
<!-- --><!----><!-----><!------>
!! result

!! end

!! test
Comment semantics and delimiters, redux
!! input
<!-- In SGML every "foo" here would actually show up in the text -- foo -- bar
-- foo -- funky huh? ... -->
!! result

!! end

!! test
Comment semantics and delimiters: directors cut
!! options
disabled
!! input
<!-- ... However we like to keep things simple and somewhat XML-ish so we eat
everything starting with < followed by !-- until the first -- and > we see,
that wouldn't be valid XML however, since in XML -- has to terminate a comment
-->-->
!! result
<p>--&gt;</p>
!! end

!! test
Comment semantics: nesting
!! options
disabled
!! input
<!--<!-- no, we're not going to do anything fancy here -->-->
!! result
<p>--&gt;</p>
!! end

!! test
Comment semantics: unclosed comment at end
!! input
<!--This comment will run out to the end of the document
!! result

!! end

!! test
Comment in template title
!! input
{{f<!---->oo}}
!! result
<p>FOO</p>
!! end

!! test
Comment on its own line post-expand
!! input
a
{{blank}}<!---->
b
!! result
<p>a</p>
<p>b</p>
!! end

###
### Preformatted text
###
!! test
Preformatted text
!! input
 This is some
 Preformatted text
 With ''italic''
 And '''bold'''
 And a [[Main Page|link]]
!! result
<pre>This is some
Preformatted text
With <i>italic</i>
And <b>bold</b>
And a <a href="/wiki/Main_Page" title="Main Page">link</a>
</pre>
!! end

!! test
<pre> with <nowiki> inside (compatibility with 1.6 and earlier)
!! input
<pre><nowiki>
<b>
<cite>
<em>
</nowiki></pre>
!! result
<pre>
&lt;b&gt;
&lt;cite&gt;
&lt;em&gt;
</pre>
!! end

!! test
Regression with preformatted in <center>
!! options
disabled
!! input
<center>
 Blah
</center>
!! result
<center>
<pre>Blah
</pre>
</center>

!! end

# Expected output in the following test is not really expected (there should be
# <pre> in the output) -- it's only testing for well-formedness.
!! test
Bug 6200: Preformatted in <blockquote>
!! input
<blockquote>
 Blah
</blockquote>
!! result
<blockquote>
 Blah
</blockquote>
!! end

!! test
<pre> with attributes (bug 3202)
!! input
<pre style="background: blue; color:white">Bluescreen of WikiDeath</pre>
!! result
<pre style="background: blue; color:white">Bluescreen of WikiDeath</pre>
!! end

!! test
<pre> with width attribute (bug 3202)
!! input
<pre width="8">Narrow screen goodies</pre>
!! result
<pre width="8">Narrow screen goodies</pre>
!! end

!! test
<pre> with forbidden attribute (bug 3202)
!! input
<pre width="8" onmouseover="alert(document.cookie)">Narrow screen goodies</pre>
!! result
<pre width="8">Narrow screen goodies</pre>
!! end

!! test
<pre> with forbidden attribute values (bug 3202)
!! input
<pre width="8" style="border-width: expression(alert(document.cookie))">Narrow screen goodies</pre>
!! result
<pre width="8">Narrow screen goodies</pre>
!! end

!! test
<nowiki> inside <pre> (bug 13238)
!! options
disabled
!! input
<pre>
<nowiki>
</pre>
<pre>
<nowiki></nowiki>
</pre>
<pre><nowiki><nowiki></nowiki>Foo<nowiki></nowiki></nowiki></pre>
!! result
<pre>
&lt;nowiki&gt;
</pre>
<pre>

</pre>
<pre>&lt;nowiki&gt;Foo&lt;/nowiki&gt;</pre>

!! end

!! test
<nowiki> and <pre> preference (first one wins)
!! options
disabled
!! input
<pre>
<nowiki>
</pre>
</nowiki>
</pre>

<nowiki>
<pre>
<nowiki>
</pre>
</nowiki>
</pre>

!! result
<pre>
&lt;nowiki&gt;
</pre>
<p>&lt;/nowiki&gt;
&lt;/pre&gt;
</p><p>
&lt;pre&gt;
&lt;nowiki&gt;
&lt;/pre&gt;

&lt;/pre&gt;
</p>
!! end


###
### Definition lists
###
!! test
Simple definition
!! options
disabled
!! input
; name : Definition
!! result
<dl>
<dt>name&#160;</dt>
<dd>Definition</dd>
</dl>
!! end

!! test
Definition list for indentation only
!! input
: Indented text
!! result
<dl>
<dd>Indented text</dd>
</dl>
!! end

!! test
Definition list with no space
!! input
;name:Definition
!! result
<dl>
<dt>name</dt>
<dd>Definition</dd>
</dl>
!!end

!! test
Definition list with URL link
!! options
disabled
!! input
; http://example.com/ : definition
!! result
<dl>
<dt><a class="external free" href="http://example.com/" rel="nofollow">http://example.com/</a>&#160;</dt>
<dd>definition</dd>
</dl>
!! end

!! test
Definition list with bracketed URL link
!! input
;[http://www.example.com/ Example]:Something about it
!! result
<dl>
<dt><a class="external text" href="http://www.example.com/" rel="nofollow">Example</a></dt>
<dd>Something about it</dd>
</dl>
!! end

!! test
Definition list with wikilink containing colon
!! options
disabled
!! input
; [[Help:FAQ]]: The least-read page on Wikipedia
!! result
<dl>
<dt><a href="/index.php?title=Help:FAQ&amp;action=edit&amp;redlink=1" class="new" title="Help:FAQ (page does not exist)">Help:FAQ</a></dt>
<dd>The least-read page on Wikipedia</dd>
</dl>
!! end

# At Brion's and JeLuF's insistence... :)
!! test
Definition list with news link containing colon
!! options
disabled
!! input
;  news:alt.wikipedia.rox: This isn't even a real newsgroup!
!! result
<dl>
<dt><a class="external free" href="news:alt.wikipedia.rox" rel="nofollow">news:alt.wikipedia.rox</a></dt>
<dd>This isn't even a real newsgroup!</dd>
</dl>
!! end

!! test
Malformed definition list with colon
!! options
disabled
!! input
;  news:alt.wikipedia.rox -- don't crash or enter an infinite loop
!! result
<dl>
<dt><a rel="nofollow" class="external free" href="news:alt.wikipedia.rox">news:alt.wikipedia.rox</a> -- don't crash or enter an infinite loop
</dt>
</dl>
!! end

!! test
Definition lists: colon in external link text
!! options
disabled
!! input
; [http://www.wikipedia2.org/ Wikipedia : The Next Generation]: OK, I made that up
!! result
<dl><dt> <a rel="nofollow" class="external text" href="http://www.wikipedia2.org/">Wikipedia&#160;: The Next Generation</a></dt><dd> OK, I made that up
</dd></dl>

!! end

!! test
Definition lists: colon in HTML attribute
!! input
;<b style="display: inline">bold</b>
!! result
<dl>
<dt><b style="display: inline">bold</b></dt>
</dl>
!! end


!! test
Definition lists: self-closed tag
!! options
disabled
!! input
;one<br/>two : two-line fun
!! result
<dl>
<dt>one<br />two&#160;</dt>
<dd>two-line fun</dd>
</dl>
!! end

!! test
Bug 11748: Literal closing tags
!! options
disabled
!! input
<dl>
<dt>test 1</dt>
<dd>test test test test test</dd>
<dt>test 2</dt>
<dd>test test test test test</dd>
</dl>
!! result
<dl>
<dt>test 1</dt>
<dd>test test test test test</dd>
<dt>test 2</dt>
<dd>test test test test test</dd>
</dl>
!! end

###
### External links
###
!! test
External links: non-bracketed
!! input
Non-bracketed: http://example.com
!! result
<p>Non-bracketed: <a class="external free" href="http://example.com" rel="nofollow">http://example.com</a></p>
!! end

!! test
External links: numbered
!! input
Numbered: [http://example.com]
Numbered: [http://example.net]
Numbered: [http://example.com]
!! result
<p>Numbered: <a class="external autonumber" href="http://example.com" rel="nofollow">[1]</a>
Numbered: <a class="external autonumber" href="http://example.net" rel="nofollow">[2]</a>
Numbered: <a class="external autonumber" href="http://example.com" rel="nofollow">[3]</a></p>
!!end

!! test
External links: specified text
!! input
Specified text: [http://example.com link]
!! result
<p>Specified text: <a class="external text" href="http://example.com" rel="nofollow">link</a></p>
!!end

!! test
External links: trail
!! input
Linktrails should not work for external links: [http://example.com link]s
!! result
<p>Linktrails should not work for external links: <a class="external text" href="http://example.com" rel="nofollow">link</a>s</p>
!! end

!! test
External links: dollar sign in URL
!! input
http://example.com/1$2345
!! result
<p><a class="external free" href="http://example.com/1$2345" rel="nofollow">http://example.com/1$2345</a></p>
!! end

!! test
External links: dollar sign in URL (named)
!! input
[http://example.com/1$2345]
!! result
<p><a class="external autonumber" href="http://example.com/1$2345" rel="nofollow">[1]</a></p>
!!end

!! test
External links: open square bracket forbidden in URL (bug 4377)
!! input
http://example.com/1[2345
!! result
<p><a class="external free" href="http://example.com/1" rel="nofollow">http://example.com/1</a>[2345</p>
!! end

!! test
External links: open square bracket forbidden in URL (named) (bug 4377)
!! input
[http://example.com/1[2345]
!! result
<p><a class="external text" href="http://example.com/1" rel="nofollow">[2345</a></p>
!!end

!! test
External links: nowiki in URL link text (bug 6230)
!! options
disabled
!!input
[http://example.com/ <nowiki>''example site''</nowiki>]
!! result
<p><a class="external text" href="http://example.com/" rel="nofollow">''example site''</a></p>
!! end

!! test
External links: newline forbidden in text (bug 6230 regression check)
!! input
[http://example.com/ first
second]
!! result
<p>[<a class="external free" href="http://example.com/" rel="nofollow">http://example.com/</a> first
second]</p>
!!end

!! test
External links: protocol-relative URL in brackets
!! input
[//example.com/ Test]
!! result
<p><a class="external text" href="//example.com/" rel="nofollow">Test</a></p>
!! end

!! test
External links: protocol-relative URL in brackets without text
!! input
[//example.com]
!! result
<p><a class="external autonumber" href="//example.com" rel="nofollow">[1]</a></p>
!! end

!! test
External links: protocol-relative URL in free text is left alone
!! input
//example.com/Foo
!! result
<p>//example.com/Foo</p>
!!end

!! test
External links: protocol-relative URL in the middle of a word is left alone (bug 30269)
!! input
foo//example.com/Foo
!! result
<p>foo//example.com/Foo</p>
!! end

!! test
External image
!! options
disabled
!! input
External image: http://meta.wikimedia.org/upload/f/f1/Ncwikicol.png
!! result
<p>External image: <img src="http://meta.wikimedia.org/upload/f/f1/Ncwikicol.png" alt="Ncwikicol.png" /></p>
!! end

!! test
External image from https
!! options
disabled
!! input
External image from https: https://meta.wikimedia.org/upload/f/f1/Ncwikicol.png
!! result
<p>External image from https: <img src="https://meta.wikimedia.org/upload/f/f1/Ncwikicol.png" alt="Ncwikicol.png" /></p>
!! end

!! test
Link to non-http image, no img tag
!! input
Link to non-http image, no img tag: ftp://example.com/test.jpg
!! result
<p>Link to non-http image, no img tag: <a class="external free" href="ftp://example.com/test.jpg" rel="nofollow">ftp://example.com/test.jpg</a></p>
!! end

!! test
External links: terminating separator
!! input
Terminating separator: http://example.com/thing,
!! result
<p>Terminating separator: <a class="external free" href="http://example.com/thing" rel="nofollow">http://example.com/thing</a>,</p>
!! end

!! test
External links: intervening separator
!! input
Intervening separator: http://example.com/1,2,3
!! result
<p>Intervening separator: <a class="external free" href="http://example.com/1,2,3" rel="nofollow">http://example.com/1,2,3</a></p>
!! end

!! test
External links: old bug with URL in query
!! input
Old bug with URL in query: [http://example.com/thing?url=http://example.com link]
!! result
<p>Old bug with URL in query: <a class="external text" href="http://example.com/thing?url=http://example.com" rel="nofollow">link</a></p>
!! end

!! test
External links: old URL-in-URL bug, mixed protocols
!! input
And again with mixed protocols: [ftp://example.com?url=http://example.com link]
!! result
<p>And again with mixed protocols: <a class="external text" href="ftp://example.com?url=http://example.com" rel="nofollow">link</a></p>
!!end

!! test
External links: URL in text
!! options
disabled
!! input
URL in text: [http://example.com http://example.com]
!! result
<p>URL in text: <a class="external free" href="http://example.com" rel="nofollow">http://example.com</a></p>
!! end

!! test
External links: Clickable images
!! options
disabled
!! input
ja-style clickable images: [http://example.com http://meta.wikimedia.org/upload/f/f1/Ncwikicol.png]
!! result
<p>ja-style clickable images: <a class="external text" href="http://example.com" rel="nofollow"><img src="http://meta.wikimedia.org/upload/f/f1/Ncwikicol.png" alt="Ncwikicol.png" /></a></p>
!!end

!! test
External links: raw ampersand
!! options
disabled
!! input
Old &amp; use: http://x&y
!! result
<p>Old &amp; use: <a class="external free" href="http://x&amp;y" rel="nofollow">http://x&amp;y</a></p>
!! end

!! test
External links: encoded ampersand
!! options
disabled
!! input
Old &amp; use: http://x&amp;y
!! result
<p>Old &amp; use: <a class="external free" href="http://x&amp;y" rel="nofollow">http://x&amp;y</a></p>
!! end

!! test
External links: encoded equals (bug 6102)
!! options
disabled
!! input
http://example.com/?foo&#61;bar
!! result
<p><a class="external free" href="http://example.com/?foo=bar" rel="nofollow">http://example.com/?foo=bar</a></p>
!! end

!! test
External links: [raw ampersand]
!! options
disabled
!! input
Old &amp; use: [http://x&y]
!! result
<p>Old &amp; use: <a class="external autonumber" href="http://x&amp;y" rel="nofollow">[1]</a></p>
!! end

!! test
External links: [encoded ampersand]
!! options
disabled
!! input
Old &amp; use: [http://x&amp;y]
!! result
<p>Old &amp; use: <a class="external autonumber" href="http://x&amp;y" rel="nofollow">[1]</a></p>
!! end

!! test
External links: [encoded equals] (bug 6102)
!! options
disabled
!! input
[http://example.com/?foo&#61;bar]
!! result
<p><a class="external autonumber" href="http://example.com/?foo=bar" rel="nofollow">[1]</a></p>
!! end

!! test
External links: [IDN ignored character reference in hostname; strip it right off]
!! options
disabled
!! input
[http://e&zwnj;xample.com/]
!! result
<p><a class="external autonumber" href="http://example.com/" rel="nofollow">[1]</a></p>
!! end

!! test
External links: IDN ignored character reference in hostname; strip it right off
!! options
disabled
!! input
http://e&zwnj;xample.com/
!! result
<p><a class="external free" href="http://example.com/" rel="nofollow">http://example.com/</a></p>
!! end

!! test
External links: www.jpeg.org (bug 554)
!! input
http://www.jpeg.org
!!result
<p><a class="external free" href="http://www.jpeg.org" rel="nofollow">http://www.jpeg.org</a></p>
!! end

!! test
External links: URL within URL (original bug 2)
!! input
[http://www.unausa.org/newindex.asp?place=http://www.unausa.org/programs/mun.asp]
!! result
<p><a class="external autonumber" href="http://www.unausa.org/newindex.asp?place=http://www.unausa.org/programs/mun.asp" rel="nofollow">[1]</a></p>
!! end

!! test
BUG 361: URL inside bracketed URL
!! options
disabled
!! input
[http://www.example.com/foo http://www.example.com/bar]
!! result
<p><a class="external text" href="http://www.example.com/foo" rel="nofollow">http://www.example.com/bar</a></p>
!! end

!! test
BUG 361: URL within URL, not bracketed
!! input
http://www.example.com/foo?=http://www.example.com/bar
!! result
<p><a class="external free" href="http://www.example.com/foo?=http://www.example.com/bar" rel="nofollow">http://www.example.com/foo?=http://www.example.com/bar</a></p>
!! end

!! test
BUG 289: ">"-token in URL-tail
!! options
disabled
!! input
http://www.example.com/<hello>
!! result
<p><a class="external free" href="http://www.example.com/" rel="nofollow">http://www.example.com/</a>&lt;hello&gt;</p>
!!end

!! test
BUG 289: literal ">"-token in URL-tail
!! input
http://www.example.com/<b>html</b>
!! result
<p><a class="external free" href="http://www.example.com/" rel="nofollow">http://www.example.com/</a><b>html</b></p>
!!end

!! test
BUG 289: ">"-token in bracketed URL
!! options
disabled
!! input
[http://www.example.com/<hello> stuff]
!! result
<p><a class="external text" href="http://www.example.com/" rel="nofollow">&lt;hello&gt; stuff</a></p>
!!end

!! test
BUG 289: literal ">"-token in bracketed URL
!! input
[http://www.example.com/<b>html</b> stuff]
!! result
<p><a class="external text" href="http://www.example.com/" rel="nofollow"><b>html</b> stuff</a></p>
!!end

!! test
BUG 289: literal double quote at end of URL
!! options
disabled
!! input
http://www.example.com/"hello"
!! result
<p><a class="external free" href="http://www.example.com/" rel="nofollow">http://www.example.com/</a>"hello"</p>
!!end

!! test
BUG 289: literal double quote in bracketed URL
!! options
disabled
!! input
[http://www.example.com/"hello" stuff]
!! result
<p><a class="external text" href="http://www.example.com/" rel="nofollow">"hello" stuff</a></p>
!!end

!! test
External links: multiple legal whitespace is fine, Magnus. Don't break it please. (bug 5081)
!! input
[http://www.example.com  test]
!! result
<p><a class="external text" href="http://www.example.com" rel="nofollow">test</a></p>
!! end

!! test
External links: wiki links within external link (Bug 3695)
!! options
disabled
!! input
[http://example.com [[wikilink]] embedded in ext link]
!! result
<p><a class="external text" href="http://example.com" rel="nofollow"></a><a href="/index.php?title=Wikilink&amp;action=edit&amp;redlink=1" class="new" title="Wikilink (page does not exist)">wikilink</a><a class="external text" href="http://example.com" rel="nofollow"> embedded in ext link</a></p>
!! end

!! test
BUG 787: Links with one slash after the url protocol are invalid
!! input
http:/example.com

[http:/example.com title]
!! result
<p>http:/example.com</p>
<p>[http:/example.com title]</p>
!! end

!! test
Bug 2702: Mismatched <i>, <b> and <a> tags are invalid
!! options
disabled
!! input
''[http://example.com text'']
[http://example.com '''text]'''
''Something [http://example.com in italic'']
''Something [http://example.com mixed''''', even bold]'''
'''''Now [http://example.com both''''']
!! result
<p><a class="external text" href="http://example.com" rel="nofollow"><i>text</i></a>
<a class="external text" href="http://example.com" rel="nofollow"><b>text</b></a>
<i>Something </i><a class="external text" href="http://example.com" rel="nofollow"><i>in italic</i></a>
<i>Something </i><a class="external text" href="http://example.com" rel="nofollow"><i>mixed</i><b>, even bold</b></a>
<i><b>Now </b></i><a class="external text" href="http://example.com" rel="nofollow"><i><b>both</b></i></a></p>
!! end


!! test
Bug 4781: %26 in URL
!! input
http://www.example.com/?title=AT%26T
!! result
<p><a class="external free" href="http://www.example.com/?title=AT%26T" rel="nofollow">http://www.example.com/?title=AT%26T</a></p>
!! end

!! test
Bug 4781, 5267: %26 in URL
!! input
http://www.example.com/?title=100%25_Bran
!! result
<p><a class="external free" href="http://www.example.com/?title=100%25_Bran" rel="nofollow">http://www.example.com/?title=100%25_Bran</a></p>
!! end

!! test
Bug 4781, 5267: %28, %29 in URL
!! input
http://www.example.com/?title=Ben-Hur_%281959_film%29
!! result
<p><a class="external free" href="http://www.example.com/?title=Ben-Hur_%281959_film%29" rel="nofollow">http://www.example.com/?title=Ben-Hur_%281959_film%29</a></p>
!! end


!! test
Bug 4781: %26 in autonumber URL
!! input
[http://www.example.com/?title=AT%26T]
!! result
<p><a class="external autonumber" href="http://www.example.com/?title=AT%26T" rel="nofollow">[1]</a></p>
!! end

!! test
Bug 4781, 5267: %26 in autonumber URL
!! input
[http://www.example.com/?title=100%25_Bran]
!! result
<p><a class="external autonumber" href="http://www.example.com/?title=100%25_Bran" rel="nofollow">[1]</a></p>
!! end

!! test
Bug 4781, 5267: %28, %29 in autonumber URL
!! input
[http://www.example.com/?title=Ben-Hur_%281959_film%29]
!! result
<p><a class="external autonumber" href="http://www.example.com/?title=Ben-Hur_%281959_film%29" rel="nofollow">[1]</a></p>
!! end


!! test
Bug 4781: %26 in bracketed URL
!! input
[http://www.example.com/?title=AT%26T link]
!! result
<p><a class="external text" href="http://www.example.com/?title=AT%26T" rel="nofollow">link</a></p>
!! end

!! test
Bug 4781, 5267: %26 in bracketed URL
!! input
[http://www.example.com/?title=100%25_Bran link]
!! result
<p><a class="external text" href="http://www.example.com/?title=100%25_Bran" rel="nofollow">link</a></p>
!! end

!! test
Bug 4781, 5267: %28, %29 in bracketed URL
!! input
[http://www.example.com/?title=Ben-Hur_%281959_film%29 link]
!! result
<p><a class="external text" href="http://www.example.com/?title=Ben-Hur_%281959_film%29" rel="nofollow">link</a></p>
!! end

!! test
External link containing double-single-quotes in text '' (bug 4598 sanity check)
!! options
disabled
!! input
Some [http://example.com/ pretty ''italics'' and stuff]!
!! result
<p>Some <a class="external text" href="http://example.com/" rel="nofollow">pretty <i>italics</i> and stuff</a>!</p>
!! end

!! test
External link containing double-single-quotes in text embedded in italics (bug 4598 sanity check)
!! options
disabled
!! input
''Some [http://example.com/ pretty ''italics'' and stuff]!''
!! result
<p><i>Some </i><a class="external text" href="http://example.com/" rel="nofollow"><i>pretty </i>italics<i> and stuff</i></a><i>!</i></p>
!! end

!! test
External link containing double-single-quotes with no space separating the url from text in italics
!! options
disabled
!! input
[http://www.musee-picasso.fr/pages/page_id18528_u1l2.htm''La muerte de Casagemas'' (1901) en el sitio de [[Museo Picasso (París)|Museo Picasso]].]
!! result
<p><a class="external text" href="http://www.musee-picasso.fr/pages/page_id18528_u1l2.htm" rel="nofollow"><i>La muerte de Casagemas</i> (1901) en el sitio de <a href="/index.php?title=Museo_Picasso_(Par%C3%ADs)&amp;action=edit&amp;redlink=1" class="new" title="Museo Picasso (París) (page does not exist)">Museo Picasso</a>.</a></p>
!! end

!! test
URL-encoding in URL functions (single parameter)
!! options
disabled
!! input
{{localurl:Some page|amp=&}}
!! result
<p>/index.php?title=Some_page&amp;amp=&amp;
</p>
!! end

!! test
URL-encoding in URL functions (multiple parameters)
!! options
disabled
!! input
{{localurl:Some page|q=?&amp=&}}
!! result
<p>/index.php?title=Some_page&amp;q=?&amp;amp=&amp;
</p>
!! end
